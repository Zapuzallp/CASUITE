{% extends 'base.html' %}
{% load static %}
{% block body %}

<main id="main" class="main">

  <div class="pagetitle">
    <h1>All Payments</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="{% url 'dashboard' %}">Home</a>
        </li>
        <li class="breadcrumb-item active">Payments</li>
      </ol>
    </nav>
  </div>

  <section class="section">
    <div class="card shadow-sm border-0">
      <div class="card-body">

        <!-- HEADER -->
        <div class="d-flex justify-content-between align-items-center my-3">
          <h5 class="card-title m-0">Payment Management</h5>

          <!-- ✅ SIMPLE REDIRECT BUTTON -->
          <a href="{% url 'invoice_select' %}"
             class="btn btn-primary btn-sm">
            <i class="bi bi-plus-lg me-1"></i>
            Add New Payment
          </a>
        </div>

        <!-- TABLE -->
        <table class="table table-hover datatable align-middle">
          <thead class="table-light">
            <tr>
              <th>S.N.</th>
              <th>Invoice</th>
              <th>Client</th>
              <th>Amount Paid</th>
              <th>Method</th>
              <th>Transaction ID</th>
              <th>Date</th>
              <th>Created By</th>
            </tr>
          </thead>
          <tbody>

            {% for payment in payments %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td class="fw-bold">{{ payment.invoice.invoice_number }}</td>
              <td>{{ payment.invoice.client.client_name }}</td>
              <td class="fw-bold">₹ {{ payment.amount }}</td>
              <td>{{ payment.payment_method }}</td>
              <td>
                {% if payment.transaction_id %}
                  {{ payment.transaction_id }}
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
              <td>{{ payment.payment_date|date:"M d, Y" }}</td>
              <td>{{ payment.created_by.username }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="8" class="text-center text-muted">
                No payments found.
              </td>
            </tr>
            {% endfor %}

          </tbody>
        </table>

      </div>
    </div>
  </section>

</main>

{% endblock body %}
